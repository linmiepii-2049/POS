<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>SDK ç’°å¢ƒè®Šæ•¸æ¸¬è©¦</title>
  <style>
    body {
      font-family: monospace;
      padding: 20px;
      background: #1a1a1a;
      color: #00ff00;
    }
    .test-section {
      margin: 20px 0;
      padding: 15px;
      background: #2a2a2a;
      border-radius: 8px;
    }
    .success { color: #00ff00; }
    .error { color: #ff0000; }
    .warning { color: #ffaa00; }
    pre {
      background: #0a0a0a;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>ğŸ§ª SDK ç’°å¢ƒè®Šæ•¸æ¸¬è©¦</h1>
  
  <div class="test-section">
    <h2>ğŸ“Œ ç•¶å‰ç’°å¢ƒ</h2>
    <pre id="current-env"></pre>
  </div>

  <div class="test-section">
    <h2>ğŸ”— SDK URL ç”Ÿæˆæ¸¬è©¦</h2>
    <pre id="url-test"></pre>
  </div>

  <div class="test-section">
    <h2>âœ… ç’°å¢ƒåˆ¤æ–·é‚è¼¯</h2>
    <pre id="logic-test"></pre>
  </div>

  <script type="module">
    // æ¨¡æ“¬ SDK çš„ getBaseURL å‡½æ•¸
    function getBaseURL() {
      // ç€è¦½å™¨ç’°å¢ƒï¼šä½¿ç”¨ Vite ç’°å¢ƒè®Šæ•¸
      if (typeof window !== 'undefined') {
        try {
          // åœ¨ç€è¦½å™¨ä¸­ï¼Œimport.meta.env æœƒè¢« Vite æ›¿æ›
          const viteEnv = import.meta.env?.VITE_API_BASE_URL;
          if (viteEnv) {
            return viteEnv;
          }
        } catch (e) {
          // Fallback
        }
      }
      
      // é è¨­å€¼ï¼šæœ¬åœ°é–‹ç™¼
      return 'http://localhost:8787';
    }

    function createFullURL(path) {
      const baseURL = getBaseURL();
      return `${baseURL}${path}`;
    }

    // é¡¯ç¤ºç•¶å‰ç’°å¢ƒ
    const currentEnv = document.getElementById('current-env');
    const viteApiBaseUrl = import.meta.env?.VITE_API_BASE_URL;
    currentEnv.innerHTML = `
<span class="success">ç•¶å‰ç’°å¢ƒè®Šæ•¸:</span>
VITE_API_BASE_URL = ${viteApiBaseUrl ? `"${viteApiBaseUrl}"` : '<span class="warning">undefined (ä½¿ç”¨é è¨­å€¼)</span>'}

<span class="success">getBaseURL() å›å‚³:</span>
${getBaseURL()}

<span class="success">åˆ¤æ–·ä¾æ“š:</span>
${viteApiBaseUrl ? 'ä½¿ç”¨ VITE_API_BASE_URL' : 'ä½¿ç”¨é è¨­å€¼ http://localhost:8787'}
`;

    // URL ç”Ÿæˆæ¸¬è©¦
    const urlTest = document.getElementById('url-test');
    urlTest.innerHTML = `
<span class="success">Health URL:</span>    ${createFullURL('/health')}
<span class="success">Version URL:</span>   ${createFullURL('/version')}
<span class="success">Data URL:</span>      ${createFullURL('/api/data')}
<span class="success">Users URL:</span>     ${createFullURL('/api/users')}
<span class="success">Products URL:</span>  ${createFullURL('/api/products')}
`;

    // ç’°å¢ƒåˆ¤æ–·é‚è¼¯èªªæ˜
    const logicTest = document.getElementById('logic-test');
    logicTest.innerHTML = `
<span class="success">âœ… æ¨¡å¼ B: SDK é€é env æ±ºå®š URL</span>

<span class="success">ç’°å¢ƒé…ç½®:</span>
1. <span class="warning">Development (.env.local æˆ–ç„¡ .env)</span>
   VITE_API_BASE_URL = undefined æˆ– "http://localhost:8787"
   â†’ ä½¿ç”¨é è¨­å€¼: http://localhost:8787

2. <span class="warning">Staging (.env.staging)</span>
   VITE_API_BASE_URL = "https://api-staging.example.com"
   â†’ ä½¿ç”¨ç’°å¢ƒè®Šæ•¸: https://api-staging.example.com

3. <span class="warning">Production (.env.production)</span>
   VITE_API_BASE_URL = "https://api.example.com"
   â†’ ä½¿ç”¨ç’°å¢ƒè®Šæ•¸: https://api.example.com

<span class="success">å„ªé»:</span>
- âœ… ä¸€ä»½ SDKï¼Œå¤šç’°å¢ƒå…±ç”¨
- âœ… ä¸éœ€è¦ç‚ºæ¯å€‹ç’°å¢ƒé‡æ–°ç”Ÿæˆ SDK
- âœ… åªéœ€ä¿®æ”¹ .env.* æª”æ¡ˆ
- âœ… ç¬¦åˆ SSOT åŸå‰‡
`;

    // å¯¦éš›æ¸¬è©¦ API èª¿ç”¨
    setTimeout(async () => {
      try {
        const healthUrl = createFullURL('/health');
        const response = await fetch(healthUrl);
        const data = await response.json();
        
        currentEnv.innerHTML += `

<span class="success">ğŸ‰ å¯¦éš› API æ¸¬è©¦:</span>
è«‹æ±‚ URL: ${healthUrl}
å›æ‡‰: ${JSON.stringify(data, null, 2)}
<span class="${data.ok ? 'success' : 'error'}">ç‹€æ…‹: ${data.ok ? 'âœ… æ­£å¸¸' : 'âŒ ç•°å¸¸'}</span>
`;
      } catch (error) {
        currentEnv.innerHTML += `

<span class="error">âŒ API æ¸¬è©¦å¤±æ•—:</span>
${error.message}
`;
      }
    }, 500);
  </script>
</body>
</html>
