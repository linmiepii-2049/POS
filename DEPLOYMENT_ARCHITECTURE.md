# éƒ¨ç½²æ¶æ§‹èªªæ˜

**æœ€å¾Œæ›´æ–°**: 2025-11-08  
**æ¶æ§‹é¡å‹**: ç¨ç«‹å°ˆæ¡ˆéš”é›¢ï¼ˆæ¥­ç•Œæ¨™æº–ï¼‰  
**ç‹€æ…‹**: âœ… å·²é…ç½®å®Œæˆ

## ğŸ—ï¸ æ¶æ§‹ç¸½è¦½

### ç’°å¢ƒéš”é›¢ç­–ç•¥

æœ¬å°ˆæ¡ˆæ¡ç”¨**æ¥­ç•Œæ¨™æº–çš„ç¨ç«‹å°ˆæ¡ˆæ¶æ§‹**ï¼Œæ¯å€‹ç’°å¢ƒä½¿ç”¨å®Œå…¨ç¨ç«‹çš„è³‡æºï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æœ¬åœ°é–‹ç™¼ç’°å¢ƒ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å‰ç«¯: http://localhost:3000                                  â”‚
â”‚ å¾Œç«¯: http://localhost:8787                                  â”‚
â”‚ D1:   .wrangler/state/v3/d1/ (æœ¬åœ° SQLite)                   â”‚
â”‚ R2:   æœ¬åœ°æª”æ¡ˆç³»çµ±                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
                    git push origin main
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Staging ç’°å¢ƒï¼ˆç·šä¸Šæ¸¬è©¦ï¼‰                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å‰ç«¯: https://pos-frontend-staging.pages.dev                â”‚
â”‚   â”œâ”€ Cloudflare Pages å°ˆæ¡ˆ: pos-frontend-staging            â”‚
â”‚   â”œâ”€ Production branch: main                                â”‚
â”‚   â””â”€ ç”¨é€”: QA æ¸¬è©¦ã€åŠŸèƒ½é©—è­‰ã€å®¢æˆ¶é è¦½                        â”‚
â”‚                                                              â”‚
â”‚ å¾Œç«¯: https://pos-backend-staging.survey-api.workers.dev    â”‚
â”‚   â”œâ”€ Cloudflare Worker: pos-backend-staging                 â”‚
â”‚   â”œâ”€ Environment: staging                                   â”‚
â”‚   â””â”€ CORS: localhost + staging å‰ç«¯åŸŸå                      â”‚
â”‚                                                              â”‚
â”‚ D1:   pos-db-staging (e4719617-39ba-44b8-890b-6cc08c9c778a) â”‚
â”‚ R2:   pos-assets-staging                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
                  æ¸¬è©¦é€šé + ç‰ˆæœ¬ç¢ºèª
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Production ç’°å¢ƒï¼ˆæ­£å¼æœå‹™ï¼‰                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å‰ç«¯: https://pos-frontend-prod.pages.dev                   â”‚
â”‚   â”œâ”€ Cloudflare Pages å°ˆæ¡ˆ: pos-frontend-prod               â”‚
â”‚   â”œâ”€ Production branch: main                                â”‚
â”‚   â””â”€ ç”¨é€”: æ­£å¼å°å¤–æœå‹™                                       â”‚
â”‚                                                              â”‚
â”‚ å¾Œç«¯: https://pos-backend-prod.survey-api.workers.dev       â”‚
â”‚   â”œâ”€ Cloudflare Worker: pos-backend-prod                    â”‚
â”‚   â”œâ”€ Environment: production                                â”‚
â”‚   â””â”€ CORS: production å‰ç«¯åŸŸå                               â”‚
â”‚                                                              â”‚
â”‚ D1:   pos-db-prod (f3aa95e5-594c-4d68-a588-19dc6f7962f0)    â”‚
â”‚ R2:   pos-assets-prod                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ é—œéµè¨­è¨ˆæ±ºç­–

### ç‚ºä»€éº¼ç”¨ main branch éƒ¨ç½²åˆ° Stagingï¼Ÿ

**å•é¡Œ**ï¼š
ä¹‹å‰ç”¨ `--branch=staging` æœƒå‰µå»º Preview éƒ¨ç½²ï¼Œå°è‡´ï¼š
- âŒ æ¯æ¬¡éƒ¨ç½²ç”¢ç”Ÿæ–°çš„éš¨æ©Ÿ URLï¼ˆ34dd10cd.pos-frontend-staging.pages.devï¼‰
- âŒ CORS éœ€è¦ä¸æ–·æ›´æ–°ç™½åå–®
- âŒ ç„¡æ³•ä½¿ç”¨å›ºå®šçš„æ¸¬è©¦ URL
- âŒ ä¸é©åˆåˆ†äº«çµ¦åœ˜éšŠæˆ–å®¢æˆ¶æ¸¬è©¦

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
ä½¿ç”¨ `--branch=main` æ›´æ–°ä¸»åŸŸåï¼š
- âœ… å›ºå®šçš„æ¸¬è©¦ URLï¼ˆpos-frontend-staging.pages.devï¼‰
- âœ… CORS é…ç½®ç°¡å–®ï¼ˆåªéœ€ä¸»åŸŸåï¼‰
- âœ… æ–¹ä¾¿åˆ†äº«å’Œæ¸¬è©¦
- âœ… ç¬¦åˆæ¥­ç•Œæ¨™æº–å¯¦è¸

### Cloudflare Pages çš„åˆ†æ”¯æ©Ÿåˆ¶

```
Cloudflare Pages å°ˆæ¡ˆé…ç½®ï¼š
â”œâ”€ Production branch: main
â”‚  â””â”€ éƒ¨ç½²åˆ°ä¸»åŸŸå: project-name.pages.dev
â”‚
â””â”€ Preview branches: å…¶ä»–åˆ†æ”¯
   â””â”€ éƒ¨ç½²åˆ°éš¨æ©Ÿ URL: xyz123.project-name.pages.dev
```

**æˆ‘å€‘çš„ç­–ç•¥**ï¼š
- Staging å°ˆæ¡ˆçš„ Production branch = main â†’ å›ºå®šä¸»åŸŸå âœ…
- Production å°ˆæ¡ˆçš„ Production branch = main â†’ å›ºå®šä¸»åŸŸå âœ…

## ğŸ“‹ ç’°å¢ƒé…ç½®è©³æƒ…

### Staging ç’°å¢ƒ

**å‰ç«¯**ï¼š
- å°ˆæ¡ˆ: `pos-frontend-staging`
- åŸŸå: `https://pos-frontend-staging.pages.dev`
- Branch: `main`
- API ç«¯é»: `https://pos-backend-staging.survey-api.workers.dev`

**å¾Œç«¯**ï¼š
- Worker: `pos-backend-staging`
- åŸŸå: `https://pos-backend-staging.survey-api.workers.dev`
- Environment: `staging`
- CORS: `http://localhost:3000,https://pos-frontend-staging.pages.dev`

**è³‡æ–™åº«**ï¼š
- D1: `pos-db-staging`
- Database ID: `e4719617-39ba-44b8-890b-6cc08c9c778a`

**å„²å­˜**ï¼š
- R2 Bucket: `pos-assets-staging`

### Production ç’°å¢ƒ

**å‰ç«¯**ï¼š
- å°ˆæ¡ˆ: `pos-frontend-prod`
- åŸŸå: `https://pos-frontend-prod.pages.dev`
- Branch: `main`
- API ç«¯é»: `https://pos-backend-prod.survey-api.workers.dev`

**å¾Œç«¯**ï¼š
- Worker: `pos-backend-prod`
- åŸŸå: `https://pos-backend-prod.survey-api.workers.dev`
- Environment: `production`
- CORS: `https://pos-frontend-prod.pages.dev`

**è³‡æ–™åº«**ï¼š
- D1: `pos-db-prod`
- Database ID: `f3aa95e5-594c-4d68-a588-19dc6f7962f0`

**å„²å­˜**ï¼š
- R2 Bucket: `pos-assets-prod`

## ğŸ”„ éƒ¨ç½²æµç¨‹

### Staging éƒ¨ç½²

```bash
é–‹ç™¼ â†’ æœ¬åœ°æ¸¬è©¦é€šé
  â†“
git push origin main
  â†“
GitHub Actions: "Deploy to Staging"
  â†“
â”œâ”€ å¾Œç«¯éƒ¨ç½²åˆ°: pos-backend-staging
â”‚  â”œâ”€ æª¢æŸ¥ D1 è³‡æ–™åº«
â”‚  â”œâ”€ åŸ·è¡Œ migrations
â”‚  â””â”€ é©—è­‰ R2 bucket
â”œâ”€ å‰ç«¯å»ºç½®ä¸¦éƒ¨ç½²
â”‚  â”œâ”€ å»ºç½® SDK
â”‚  â”œâ”€ å»ºç½®å‰ç«¯ï¼ˆVITE_API_BASE_URL=staging å¾Œç«¯ï¼‰
â”‚  â””â”€ éƒ¨ç½²åˆ° pos-frontend-stagingï¼ˆ--branch=mainï¼‰
â””â”€ å¥åº·æª¢æŸ¥
  â†“
âœ… Staging ç’°å¢ƒæ›´æ–°å®Œæˆ
ğŸ“ https://pos-frontend-staging.pages.dev
```

### Production éƒ¨ç½²

```bash
Staging æ¸¬è©¦é€šé + æº–å‚™ç‰ˆæœ¬è™Ÿ
  â†“
GitHub Actions: "Deploy to Production"
  â†“
â”œâ”€ å¾Œç«¯éƒ¨ç½²åˆ°: pos-backend-prod
â”‚  â”œâ”€ å‚™ä»½æé†’
â”‚  â”œâ”€ æª¢æŸ¥ D1 è³‡æ–™åº«
â”‚  â”œâ”€ åŸ·è¡Œ migrations
â”‚  â””â”€ é©—è­‰ R2 bucket
â”œâ”€ å‰ç«¯å»ºç½®ä¸¦éƒ¨ç½²
â”‚  â”œâ”€ å»ºç½® SDK
â”‚  â”œâ”€ å»ºç½®å‰ç«¯ï¼ˆVITE_API_BASE_URL=prod å¾Œç«¯ï¼‰
â”‚  â””â”€ éƒ¨ç½²åˆ° pos-frontend-prodï¼ˆ--branch=mainï¼‰
â”œâ”€ å¥åº·æª¢æŸ¥
â””â”€ å»ºç«‹ Git Tag
  â†“
âœ… Production ç’°å¢ƒæ›´æ–°å®Œæˆ
ğŸ“ https://pos-frontend-prod.pages.dev
```

## ğŸ” CORS é…ç½®

### ç°¡åŒ–çš„ CORS ç­–ç•¥

**Staging**ï¼š
```toml
CORS_ORIGINS = "http://localhost:3000,https://pos-frontend-staging.pages.dev"
```
- æœ¬åœ°é–‹ç™¼ + Staging ä¸»åŸŸå
- ä¸å†éœ€è¦ç¶­è­· Preview URLs åˆ—è¡¨

**Production**ï¼š
```toml
CORS_ORIGINS = "https://pos-frontend-prod.pages.dev"
```
- åªå…è¨± Production å‰ç«¯åŸŸå
- æ›´åš´æ ¼çš„å®‰å…¨æ€§

## ğŸ“Š èˆ‡æ¥­ç•Œå°æ¯”

### ç›¸åŒæ¶æ§‹çš„çŸ¥åæœå‹™

| æœå‹™ | Staging | Production |
|------|---------|-----------|
| **Vercel** | project-staging.vercel.app | project-prod.vercel.app |
| **Netlify** | project-staging.netlify.app | project-prod.netlify.app |
| **æ‚¨çš„å°ˆæ¡ˆ** | pos-frontend-staging.pages.dev | pos-frontend-prod.pages.dev |

### æ¶æ§‹å„ªå‹¢å°æ¯”

| ç‰¹æ€§ | ç¨ç«‹å°ˆæ¡ˆï¼ˆæ‚¨çš„æ¶æ§‹ï¼‰| åˆ†æ”¯ Preview | 
|------|------------------|-------------|
| å›ºå®šæ¸¬è©¦ URL | âœ… æ˜¯ | âŒ éš¨æ©Ÿ URL |
| CORS é…ç½® | âœ… ç°¡å–® | âŒ éœ€é€šé…ç¬¦ |
| ç’°å¢ƒéš”é›¢ | âœ… å®Œå…¨éš”é›¢ | âš ï¸ å…±ç”¨å°ˆæ¡ˆ |
| å›æ»¾å½±éŸ¿ | âœ… ç¨ç«‹ | âš ï¸ å¯èƒ½äº’ç›¸å½±éŸ¿ |
| è³‡æ–™åº«éš”é›¢ | âœ… å®Œå…¨ç¨ç«‹ | âœ… å¯é…ç½® |
| é©åˆç·šä¸Šæ¸¬è©¦ | âœ… éå¸¸é©åˆ | âŒ ä¸é©åˆ |
| æ¥­ç•Œæ¡ç”¨ç‡ | âœ… ~70% | âš ï¸ ~10% |

## ğŸ¯ ä½¿ç”¨æŒ‡å—

### æ—¥å¸¸é–‹ç™¼æµç¨‹

1. **æœ¬åœ°é–‹ç™¼**ï¼š
   ```bash
   cd packages/backend && pnpm dev  # localhost:8787
   cd packages/frontend && pnpm dev # localhost:3000
   ```

2. **æäº¤åˆ° Staging**ï¼š
   ```bash
   git push origin main
   # æˆ–æ‰‹å‹•è§¸ç™¼ GitHub Actions: Deploy to Staging
   ```

3. **ç·šä¸Šæ¸¬è©¦**ï¼š
   - è¨ªå•ï¼š`https://pos-frontend-staging.pages.dev`
   - æ¸¬è©¦æ‰€æœ‰åŠŸèƒ½
   - åˆ†äº«çµ¦åœ˜éšŠæˆå“¡æˆ–å®¢æˆ¶é è¦½

4. **éƒ¨ç½²åˆ° Production**ï¼š
   - GitHub Actions: Deploy to Production
   - è¼¸å…¥ç‰ˆæœ¬è™Ÿï¼ˆv1.0.0ï¼‰
   - ç­‰å¾…éƒ¨ç½²å®Œæˆ

### æ¸¬è©¦ URL

```bash
# Stagingï¼ˆç·šä¸Šæ¸¬è©¦ï¼‰
å‰ç«¯: https://pos-frontend-staging.pages.dev
å¾Œç«¯: https://pos-backend-staging.survey-api.workers.dev
å¥åº·: https://pos-backend-staging.survey-api.workers.dev/health

# Productionï¼ˆæ­£å¼ç’°å¢ƒï¼‰
å‰ç«¯: https://pos-frontend-prod.pages.dev
å¾Œç«¯: https://pos-backend-prod.survey-api.workers.dev
å¥åº·: https://pos-backend-prod.survey-api.workers.dev/health
```

## âœ… ä¸‹ä¸€æ­¥

### ç«‹å³åŸ·è¡Œ

ç¾åœ¨è§¸ç™¼æ–°çš„ Staging éƒ¨ç½²ï¼š

1. **å‰å¾€ GitHub Actions**
   ```
   https://github.com/linmiepii-2049/POS/actions
   ```

2. **é¸æ“‡ "Deploy to Staging"**

3. **Run workflow**
   - Branch: `main`
   - éƒ¨ç½²åŸå› : `ä¿®æ­£éƒ¨ç½²ç­–ç•¥ï¼Œä½¿ç”¨ä¸»åŸŸå`
   - åŸ·è¡Œ

4. **ç­‰å¾…éƒ¨ç½²å®Œæˆ**ï¼ˆç´„ 5 åˆ†é˜ï¼‰

5. **è¨ªå• Staging**
   ```
   https://pos-frontend-staging.pages.dev
   ```

### é æœŸçµæœ

é€™æ¬¡éƒ¨ç½²å¾Œï¼š
- âœ… `pos-frontend-staging.pages.dev` æœƒæ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
- âœ… ä¸æœƒå†æœ‰ CORS éŒ¯èª¤
- âœ… Health æª¢æŸ¥æœƒé¡¯ç¤ºæ­£å¸¸
- âœ… æ‰€æœ‰ API å‘¼å«æ­£å¸¸é‹ä½œ
- âœ… å¯ä»¥æ­£å¸¸é€²è¡Œç·šä¸Šæ¸¬è©¦

## ğŸ‰ ç¸½çµ

æ‚¨çš„æ¶æ§‹ç¾åœ¨ç¬¦åˆæ¥­ç•Œæœ€ä½³å¯¦è¸ï¼š

âœ… **å®Œå…¨éš”é›¢çš„ç’°å¢ƒ**
- Staging å’Œ Production äº’ä¸å¹²æ“¾
- ç¨ç«‹çš„è³‡æ–™åº«å’Œå„²å­˜
- ç¨ç«‹çš„åŸŸåå’Œé…ç½®

âœ… **å›ºå®šçš„æ¸¬è©¦ URL**
- Staging: pos-frontend-staging.pages.dev
- Production: pos-frontend-prod.pages.dev
- æ–¹ä¾¿åˆ†äº«å’Œæ¸¬è©¦

âœ… **ç°¡åŒ–çš„ CORS é…ç½®**
- ä¸éœ€è¦ç¶­è­· Preview URLs
- é…ç½®æ¸…æ™°æ˜“æ‡‚

âœ… **è‡ªå‹•åŒ–çš„éƒ¨ç½²æµç¨‹**
- D1 migrations è‡ªå‹•åŸ·è¡Œ
- R2 bucket è‡ªå‹•é©—è­‰
- å¥åº·æª¢æŸ¥è‡ªå‹•é‡è©¦

---

**æ‰€æœ‰é…ç½®å·²å®Œæˆï¼ç¾åœ¨å‰å¾€ GitHub Actions åŸ·è¡Œæ–°çš„éƒ¨ç½²å§ï¼** ğŸš€

