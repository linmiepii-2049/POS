name: Deploy Member Frontend to Vercel

on:
  push:
    branches: [main]
    paths:
      - 'packages/member-frontend/**'
      - 'packages/sdk/**'
      - '.github/workflows/deploy-member.yml'
  workflow_dispatch:

permissions:
  contents: read

jobs:
  deploy:
    name: éƒ¨ç½² Member å‰ç«¯åˆ° Vercel
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout ç¨‹å¼ç¢¼
        uses: actions/checkout@v4

      - name: ğŸ“¦ å®‰è£ pnpm
        uses: pnpm/action-setup@v2
        with:
          version: 8

      - name: ğŸ”§ è¨­å®š Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'pnpm'

      - name: ğŸ“š å®‰è£ä¾è³´
        run: pnpm install --frozen-lockfile

      - name: ğŸ”¨ å»ºç½® SDKï¼ˆMember ä¾è³´ï¼‰
        run: |
          cd packages/sdk
          pnpm run build

      - name: ğŸš€ éƒ¨ç½²åˆ° Vercel
        uses: amondnet/vercel-action@v25
        id: vercel-deploy
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID_MEMBER }}
          working-directory: packages/member-frontend
          scope: ${{ secrets.VERCEL_ORG_ID }}
          vercel-args: '--prod --yes'
        env:
          VITE_API_BASE: ${{ secrets.VITE_API_BASE }}
          VITE_LIFF_ID: ${{ secrets.VITE_LIFF_ID }}

      - name: âœ… éƒ¨ç½²å®Œæˆ
        run: |
          echo "ğŸ‰ Member å‰ç«¯å·²éƒ¨ç½²åˆ° Vercel"
          echo "URL: ${{ steps.vercel-deploy.outputs.preview-url }}"
